{"version":3,"sources":["src/style-settings.js","src/common-utils.js","src/document-wait.js","src/custom-style-interface.js","entrypoints/custom-style-interface.js"],"names":["nativeShadow","window","nativeCssVariables","navigator","userAgent","match","CSS","supports","parseSettings$$module$$src$style_settings","parseSettings","settings","ShadyCSS","module$$src$style_settings.nativeShadow","module$$src$style_settings.nativeCssVariables","updateNativeProperties$$module$$src$common_utils","updateNativeProperties","element","properties","p","style","removeProperty","setProperty","readyPromise","whenReady","resolveFn","documentWait$$module$$src$document_wait","documentWait","validateFn","callback","Promise","resolve","document","readyState","addEventListener","then","transformFn","constructor","CustomStyleInterface","enqueueDocumentValidation","addCustomStyle","push","getStyleForCustomStyle","customStyle","processStyles","cs","i","length","appliedStyle","attributes","attr","setAttribute","name","value","styleToTransform","prototype","Object","defineProperties","get","set","fn","needsEnqueue","customStyleInterface","prepareTemplate","styleSubtree","styleElement","styleDocument","body","getComputedStyleValue","property","getComputedStyle","getPropertyValue","trim","nativeCss"],"mappings":"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","file":"custom-style-interface.min.js","sourcesContent":["/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\n\nexport let nativeShadow = !(window['ShadyDOM'] && window['ShadyDOM']['inUse']);\n// chrome 49 has semi-working css vars, check if box-shadow works\n// safari 9.1 has a recalc bug: https://bugs.webkit.org/show_bug.cgi?id=155782\nexport let nativeCssVariables = (!navigator.userAgent.match('AppleWebKit/601') &&\nwindow.CSS && CSS.supports && CSS.supports('box-shadow', '0 0 0 var(--foo)'));\n\n/**\n * @param {ShadyCSSOptions | ShadyCSSInterface | undefined} settings\n */\nfunction parseSettings(settings) {\n  if (settings) {\n    nativeCssVariables = nativeCssVariables && !settings['nativeCss'] && !settings['shimcssproperties'];\n  nativeShadow = nativeShadow && !settings['nativeShadow'] && !settings['shimshadow'];\n  }\n}\n\nif (window.ShadyCSS) {\n  parseSettings(window.ShadyCSS);\n} else if (window['WebComponents']) {\n  parseSettings(window['WebComponents']['flags']);\n}\n","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\n\n/**\n * @param {Element} element\n * @param {Object=} properties\n */\nexport function updateNativeProperties(element, properties) {\n  // remove previous properties\n  for (let p in properties) {\n    // NOTE: for bc with shim, don't apply null values.\n    if (p === null) {\n      element.style.removeProperty(p);\n    } else {\n      element.style.setProperty(p, properties[p]);\n    }\n  }\n}\n\n/**\n * @param {Element} element\n * @param {string} property\n * @return {string}\n */\nexport function getComputedStyleValue(element, property) {\n  /**\n   * @const {string}\n   */\n  const value = window.getComputedStyle(element).getPropertyValue(property);\n  if (!value) {\n    return '';\n  } else {\n    return value.trim();\n  }\n}","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\n\n/** @type {Promise<void>} */\nlet readyPromise = null;\n\n/** @type {?function(?function())} */\nlet whenReady = window['HTMLImports'] && window['HTMLImports']['whenReady'] || null;\n\n/** @type {function()} */\nlet resolveFn;\n\n/**\n * @param {?function()} callback\n */\nexport default function documentWait(callback) {\n  if (whenReady) {\n    whenReady(callback)\n  } else {\n    if (!readyPromise) {\n      readyPromise = new Promise((resolve) => {resolveFn = resolve});\n      if (document.readyState === 'complete') {\n        resolveFn();\n      } else {\n        document.addEventListener('readystatechange', () => {\n          if (document.readyState === 'complete') {\n            resolveFn();\n          }\n        });\n      }\n    }\n    readyPromise.then(function(){ callback && callback(); });\n  }\n}","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\n\nimport documentWait from './document-wait'\n\n/**\n * @typedef {HTMLStyleElement | {getStyle: function():HTMLStyleElement}}\n */\nexport let CustomStyleProvider;\n\nconst SEEN_MARKER = '__seenByShadyCSS';\nconst CACHED_STYLE = '__shadyCSSCachedStyle';\n\n/** @type {?function(!HTMLStyleElement)} */\nlet transformFn = null;\n\n/** @type {?function()} */\nlet validateFn = null;\n\n/**\nThis interface is provided to add document-level <style> elements to ShadyCSS for processing.\nThese styles must be processed by ShadyCSS to simulate ShadowRoot upper-bound encapsulation from outside styles\nIn addition, these styles may also need to be processed for @apply rules and CSS Custom Properties\n\nTo add document-level styles to ShadyCSS, one can call `ShadyCSS.addDocumentStyle(styleElement)` or `ShadyCSS.addDocumentStyle({getStyle: () => styleElement})`\n\nIn addition, if the process used to discover document-level styles can be synchronously flushed, one should set `ShadyCSS.documentStyleFlush`.\nThis function will be called when calculating styles.\n\nAn example usage of the document-level styling api can be found in `examples/document-style-lib.js`\n\n@unrestricted\n*/\nexport default class CustomStyleInterface {\n  constructor() {\n    /** @type {!Array<!CustomStyleProvider>} */\n    this['customStyles'] = [];\n    this['enqueued'] = false;\n  }\n  /**\n   * Queue a validation for new custom styles to batch style recalculations\n   */\n  enqueueDocumentValidation() {\n    if (this['enqueued'] || !validateFn) {\n      return;\n    }\n    this['enqueued'] = true;\n    documentWait(validateFn);\n  }\n  /**\n   * @param {!HTMLStyleElement} style\n   */\n  addCustomStyle(style) {\n    if (!style[SEEN_MARKER]) {\n      style[SEEN_MARKER] = true;\n      this['customStyles'].push(style);\n      this.enqueueDocumentValidation();\n    }\n  }\n  /**\n   * @param {!CustomStyleProvider} customStyle\n   * @return {HTMLStyleElement}\n   */\n  getStyleForCustomStyle(customStyle) {\n    if (customStyle[CACHED_STYLE]) {\n      return customStyle[CACHED_STYLE];\n    }\n    let style;\n    if (customStyle['getStyle']) {\n      style = customStyle['getStyle']();\n    } else {\n      style = customStyle;\n    }\n    return style;\n  }\n  /**\n   * @return {!Array<!CustomStyleProvider>}\n   */\n  processStyles() {\n    let cs = this['customStyles'];\n    for (let i = 0; i < cs.length; i++) {\n      let customStyle = cs[i];\n      if (customStyle[CACHED_STYLE]) {\n        continue;\n      }\n      let style = this.getStyleForCustomStyle(customStyle);\n      if (style) {\n        // HTMLImports polyfill may have cloned the style into the main document,\n        // which is referenced with __appliedElement.\n        // Also, we must copy over the attributes.\n        let appliedStyle = /** @type {HTMLStyleElement} */(style['__appliedElement']);\n        if (appliedStyle) {\n          for (let i = 0; i < style.attributes.length; i++) {\n            let attr = style.attributes[i];\n            appliedStyle.setAttribute(attr.name, attr.value);\n          }\n        }\n        let styleToTransform = appliedStyle || style;\n        if (transformFn) {\n          transformFn(styleToTransform);\n        }\n        customStyle[CACHED_STYLE] = styleToTransform;\n      }\n    }\n    return cs;\n  }\n}\n\nCustomStyleInterface.prototype['addCustomStyle'] = CustomStyleInterface.prototype.addCustomStyle;\nCustomStyleInterface.prototype['getStyleForCustomStyle'] = CustomStyleInterface.prototype.getStyleForCustomStyle;\nCustomStyleInterface.prototype['processStyles'] = CustomStyleInterface.prototype.processStyles;\n\nObject.defineProperties(CustomStyleInterface.prototype, {\n  'transformCallback': {\n    /** @return {?function(!HTMLStyleElement)} */\n    get() {\n      return transformFn;\n    },\n    /** @param {?function(!HTMLStyleElement)} fn */\n    set(fn) {\n      transformFn = fn;\n    }\n  },\n  'validateCallback': {\n    /** @return {?function()} */\n    get() {\n      return validateFn;\n    },\n    /**\n     * @param {?function()} fn\n     * @this {CustomStyleInterface}\n     */\n    set(fn) {\n      let needsEnqueue = false;\n      if (!validateFn) {\n        needsEnqueue = true;\n      }\n      validateFn = fn;\n      if (needsEnqueue) {\n        this.enqueueDocumentValidation();\n      }\n    },\n  }\n})\n\n/** @typedef {{\n * customStyles: !Array<!CustomStyleProvider>,\n * addCustomStyle: function(!CustomStyleProvider),\n * getStyleForCustomStyle: function(!CustomStyleProvider): HTMLStyleElement,\n * findStyles: function(),\n * transformCallback: ?function(!HTMLStyleElement),\n * validateCallback: ?function()\n * }}\n */\nexport let CustomStyleInterfaceInterface;","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\n\nimport CustomStyleInterface from '../src/custom-style-interface'\nimport {getComputedStyleValue, updateNativeProperties} from '../src/common-utils'\nimport {nativeCssVariables, nativeShadow} from '../src/style-settings'\n\nconst customStyleInterface = new CustomStyleInterface();\n\nif (!window.ShadyCSS) {\n  window.ShadyCSS = {\n    /**\n     * @param {HTMLTemplateElement} template\n     * @param {string} elementName\n     * @param {string=} elementExtends\n     */\n    prepareTemplate(template, elementName, elementExtends) {}, // eslint-disable-line no-unused-vars\n\n    /**\n     * @param {Element} element\n     * @param {Object=} properties\n     */\n    styleSubtree(element, properties) {\n      customStyleInterface.processStyles();\n      updateNativeProperties(element, properties);\n    },\n\n    /**\n     * @param {Element} element\n     */\n    styleElement(element) { // eslint-disable-line no-unused-vars\n      customStyleInterface.processStyles();\n    },\n\n    /**\n     * @param {Object=} properties\n     */\n    styleDocument(properties) {\n      customStyleInterface.processStyles();\n      updateNativeProperties(document.body, properties);\n    },\n\n    /**\n     * @param {Element} element\n     * @param {string} property\n     * @return {string}\n     */\n    getComputedStyleValue(element, property) {\n      return getComputedStyleValue(element, property);\n    },\n    nativeCss: nativeCssVariables,\n    nativeShadow: nativeShadow\n  }\n}\n\nwindow.ShadyCSS.CustomStyleInterface = customStyleInterface;"]}